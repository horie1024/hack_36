<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style type="text/css">
    <!--
    #dialog-overlay {
      display:none;
      background: black;
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0px;
      left: 0px;
      opacity: 0.6;
     }
     #dialog {
      display:none;
      background: white;
      width: 500px;
      height: 400px;
      position: fixed;
      top: 100px;
      left: 250px;
    }
    -->
    </style>
  </head>
  <body>
    <script>
      $(document).ready(function(){
           //var socket = io.connect('http://localhost');
           var target = $("#pictures");

           //stub
           var data = [{"id":"1", "origin":"http://yahoo.co.jp", "gif":"http://livedoor.blogimg.jp/vsokuvip/imgs/b/1/b122bfe5.gif" }, {"id":"1", "origin":"http://yahoo.co.jp", "gif":"http://livedoor.blogimg.jp/vsokuvip/imgs/1/c/1cc43e81.gif" }]

//           socket.on('init', function (data) {
//               fuita(init);
//           });  
//           socket.on('fuita', function (data) {
//               fuita(data);
//           });  

            $("#init").click(function () {
                init(data);
            });
            $("#fuita").click(function () {
                fuita(data);
            });

            function init (data) {
              console.log("inited:" + data);
              target.html('');
              for (var i = data.length - 1; i >= 0; i--) {
                addImg(data[i]);
              };
            }                 
            
            function fuita (data) {
              showDialog();
              console.log("fuitad:" + data);
              addImg(data[0]);
            }

            //gifをDOMに追加する
            function addImg (img) {
               console.log(img);
               var picture = $('<img id="pictures" src="' + img.gif +'">');
               target.prepend(picture);
            }

            //吹いたダイアログ表示
            function showDialog() {
              console.log("showDialog");
              var overlay = $("#dialog-overlay");
              var dialog = $("#dialog");

              overlay.show();
              dialog.show();

              setTimeout( function() {
                overlay.hide();
                dialog.hide();
              }, 1000);

            } 
         });
    </script>
<div id="dialog-overlay"></div>
<div id="dialog">
  <p>吹いたｗｗｗｗｗｗｗｗ</p>
</div>
<header>
  <button id="init">初期化</button>
  <button id="fuita">ふいた</button>
</header>
<div id="pictures"></div>
<footer></footer>
</body>
</html>